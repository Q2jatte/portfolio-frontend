import { useEffect, useState } from "react";
import { db } from '@config/firebase';
import { getDoc, doc } from "firebase/firestore";
import ImageGallery from "react-image-gallery";

import '@styles/project.css';
import '@styles/image-galery.css';

function Project(props) {

    const { id } = props;

    const [ project, setProject] = useState(null);
    const [ images, setImages ] = useState([]);

    const docRef = doc(db, "projects", id); 
    
    // Racine des captures
    const cheminImages = "/captures/";    

    useEffect(() => {
        const getProject = async() => {
          try {
            const docSnap = await getDoc(docRef);  
            if (docSnap.exists()) {
                const data = docSnap.data();                
                setProject(data);

                // extraction des captures
                const captures = data.captureFiles.map((nomImage) => {
                    return {
                        original: `${cheminImages}original/${nomImage}`,
                        thumbnail: `${cheminImages}thumbnail/${nomImage}`,
                    };
                });
                setImages(captures);

            } else {
                console.log("Aucun document trouvé");
            }         
          } catch (err) {
            console.error(err);
          }
        };
        getProject(); 
      }, []);
    
    return (
        <>
        {project && project.name ? (
            <main className="project flux">
                <h1 className='project_title'># {project.name}</h1>
                <h2>{project.title}</h2>
                <div className='project_grid'>
                    <div>
                        <h2>Réalisations</h2>
                        <ul className='project_real-list'>
                            {project.tasks.map((task, index) => (
                                <li key={index} className='project_real-item'>{task}</li>
                            )
                            )}
                        </ul>     
                    </div>
                    <div className="project_about">   
                        <h2>À propos de ce projet</h2>
                        <p className='project_description'>{project.description}</p>
                        {project.storeURL && 
                            <a className='project_store' href={project.storeURL} target='_blank'>
                                <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <g clipPath="url(#clip0_352_2)">
                                    <path d="M22.344 0H5.656C2.5305 0 0 2.5305 0 5.656V22.3475C0 25.4695 2.5305 28 5.656 28H22.3475C25.4695 28 28.0035 25.4695 28.0035 22.344V5.656C28 2.5305 25.4695 0 22.344 0Z" fill="url(#paint0_linear_352_2)"/>
                                    <path d="M13.881 6.433L14.448 5.453C14.798 4.8405 15.5785 4.634 16.191 4.984C16.8035 5.334 17.01 6.1145 16.66 6.727L11.1965 16.184H15.148C16.429 16.184 17.1465 17.689 16.59 18.732H5.00496C4.29796 18.732 3.73096 18.165 3.73096 17.458C3.73096 16.751 4.29796 16.184 5.00496 16.184H8.25296L12.411 8.9775L11.1125 6.7235C10.7625 6.111 10.969 5.3375 11.5815 4.9805C12.194 4.6305 12.9675 4.837 13.3245 5.4495L13.881 6.433ZM8.96696 20.0445L7.74196 22.169C7.39196 22.7815 6.61146 22.988 5.99896 22.638C5.38646 22.288 5.17996 21.5075 5.52996 20.895L6.43996 19.32C7.46896 19.0015 8.30546 19.2465 8.96696 20.0445ZM19.516 16.191H22.8305C23.5375 16.191 24.1045 16.758 24.1045 17.465C24.1045 18.172 23.5375 18.739 22.8305 18.739H20.9895L22.232 20.895C22.582 21.5075 22.3755 22.281 21.763 22.638C21.1505 22.988 20.377 22.7815 20.02 22.169C17.927 18.5395 16.3555 15.8235 15.3125 14.014C14.245 12.173 15.008 10.325 15.7605 9.6985C16.597 11.1335 17.8465 13.3 19.516 16.191Z" fill="white"/>
                                    </g>
                                    <defs>
                                    <linearGradient id="paint0_linear_352_2" x1="14.0017" y1="0" x2="14.0017" y2="28" gradientUnits="userSpaceOnUse">
                                    <stop stopColor="#18BFFB"/>
                                    <stop offset="1" stopColor="#2072F3"/>
                                    </linearGradient>
                                    <clipPath id="clip0_352_2">
                                    <rect width="28" height="28" fill="white"/>
                                    </clipPath>
                                    </defs>
                                </svg>
                                <span>Voir sur le store</span>
                            </a>
                        }
                        {project.git && (
                            project.git === "Repository privé" ? (
                                <div className='project_store'>
                                    <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <g clipPath="url(#clip0_363_2)">
                                    <path d="M23.8 0H4.2C1.8804 0 0 1.8804 0 4.2V23.8C0 26.1196 1.8804 28 4.2 28H23.8C26.1196 28 28 26.1196 28 23.8V4.2C28 1.8804 26.1196 0 23.8 0Z" fill="#171515"/>
                                    <path d="M6.50772 13.9453C7.4374 15.5859 9.1874 16.5703 12.0858 16.8437C11.6483 17.1719 11.1562 17.7734 11.1015 18.4844C10.5546 18.8125 9.51553 18.9219 8.69522 18.6484C7.54678 18.2656 7.10928 16.0234 5.35928 16.3516C4.97647 16.4062 5.03115 16.6797 5.35928 16.8984C5.90615 17.2266 6.50772 17.7734 6.78115 18.5391C7.4374 20.2344 8.80459 20.6719 10.9921 20.3437V22.8047C10.9921 23.5703 9.89834 23.7891 9.89834 24.1719C9.89834 24.3359 10.2812 24.3359 10.5546 24.3359C11.1015 24.3359 12.3046 23.8437 12.3046 23.0781C12.3046 22.4219 12.3046 20.2344 12.3593 19.8516C12.3593 19.0312 12.7968 18.7578 12.7968 18.7578C12.7968 18.7578 12.8515 23.2422 12.6874 23.7891C12.4687 24.5 12.1405 24.3906 12.1405 24.7187C12.1405 25.2109 13.5624 24.8281 14.0546 23.7891C14.4374 22.9687 14.2733 18.5937 14.2187 18.6484H14.6015C14.6015 18.6484 14.6015 20.6719 14.6562 21.5469C14.6562 22.4766 14.6015 23.6797 15.1483 24.2812C15.5312 24.6641 16.7343 25.3203 16.7343 24.7187C16.7343 24.3906 16.078 24.0625 16.078 23.1328V18.8125C16.6249 18.8125 16.5155 20.2344 16.5155 20.2344L16.5702 22.8594C16.5702 22.8594 16.4608 23.8437 17.6093 24.2266C18.0468 24.3906 18.9218 24.3906 18.9765 24.1719C19.0312 23.9531 17.8827 23.5703 17.8827 22.8047V20.125C17.8827 18.1562 17.6093 17.4453 16.6796 16.8437C19.578 16.5703 21.3827 15.8594 22.2577 13.9453C22.8046 12.8516 22.914 11.5391 22.914 10.5547C22.914 7.82031 21.6015 6.89062 21.328 6.39844C21.7108 4.32031 21.2733 3.39062 21.0546 3.11719C20.289 2.84375 18.4296 3.77344 17.4452 4.42969C15.8046 3.9375 12.3046 3.99219 10.9921 4.53906C8.58584 2.84375 7.32803 3.11719 7.32803 3.11719C7.32803 3.11719 6.50772 4.59375 7.10928 6.72656C6.28897 7.71094 5.74209 8.42187 5.6874 10.2812C5.6874 11.7578 5.85147 12.6875 6.50772 13.9453Z" fill="white"/>
                                    </g>
                                    <defs>
                                    <clipPath id="clip0_363_2">
                                    <rect width="28" height="28" fill="white"/>
                                    </clipPath>
                                    </defs>
                                    </svg>
                                    <span>Repository privé</span>
                                </div>
                            ) : (
                            <a className='project_store' href={project.git} target='_blank'>
                                <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <g clipPath="url(#clip0_363_2)">
                                <path d="M23.8 0H4.2C1.8804 0 0 1.8804 0 4.2V23.8C0 26.1196 1.8804 28 4.2 28H23.8C26.1196 28 28 26.1196 28 23.8V4.2C28 1.8804 26.1196 0 23.8 0Z" fill="#171515"/>
                                <path d="M6.50772 13.9453C7.4374 15.5859 9.1874 16.5703 12.0858 16.8437C11.6483 17.1719 11.1562 17.7734 11.1015 18.4844C10.5546 18.8125 9.51553 18.9219 8.69522 18.6484C7.54678 18.2656 7.10928 16.0234 5.35928 16.3516C4.97647 16.4062 5.03115 16.6797 5.35928 16.8984C5.90615 17.2266 6.50772 17.7734 6.78115 18.5391C7.4374 20.2344 8.80459 20.6719 10.9921 20.3437V22.8047C10.9921 23.5703 9.89834 23.7891 9.89834 24.1719C9.89834 24.3359 10.2812 24.3359 10.5546 24.3359C11.1015 24.3359 12.3046 23.8437 12.3046 23.0781C12.3046 22.4219 12.3046 20.2344 12.3593 19.8516C12.3593 19.0312 12.7968 18.7578 12.7968 18.7578C12.7968 18.7578 12.8515 23.2422 12.6874 23.7891C12.4687 24.5 12.1405 24.3906 12.1405 24.7187C12.1405 25.2109 13.5624 24.8281 14.0546 23.7891C14.4374 22.9687 14.2733 18.5937 14.2187 18.6484H14.6015C14.6015 18.6484 14.6015 20.6719 14.6562 21.5469C14.6562 22.4766 14.6015 23.6797 15.1483 24.2812C15.5312 24.6641 16.7343 25.3203 16.7343 24.7187C16.7343 24.3906 16.078 24.0625 16.078 23.1328V18.8125C16.6249 18.8125 16.5155 20.2344 16.5155 20.2344L16.5702 22.8594C16.5702 22.8594 16.4608 23.8437 17.6093 24.2266C18.0468 24.3906 18.9218 24.3906 18.9765 24.1719C19.0312 23.9531 17.8827 23.5703 17.8827 22.8047V20.125C17.8827 18.1562 17.6093 17.4453 16.6796 16.8437C19.578 16.5703 21.3827 15.8594 22.2577 13.9453C22.8046 12.8516 22.914 11.5391 22.914 10.5547C22.914 7.82031 21.6015 6.89062 21.328 6.39844C21.7108 4.32031 21.2733 3.39062 21.0546 3.11719C20.289 2.84375 18.4296 3.77344 17.4452 4.42969C15.8046 3.9375 12.3046 3.99219 10.9921 4.53906C8.58584 2.84375 7.32803 3.11719 7.32803 3.11719C7.32803 3.11719 6.50772 4.59375 7.10928 6.72656C6.28897 7.71094 5.74209 8.42187 5.6874 10.2812C5.6874 11.7578 5.85147 12.6875 6.50772 13.9453Z" fill="white"/>
                                </g>
                                <defs>
                                <clipPath id="clip0_363_2">
                                <rect width="28" height="28" fill="white"/>
                                </clipPath>
                                </defs>
                                </svg>
                                <span>Repository public</span>
                            </a>
                            )
                        )}                        
                    </div>                    
                </div> 
                <div className='card_tag-list project_tags'>
                    {project.tags.map((tag, index) => (                   
                        <span key={index} className='card_tag-item'>{tag}</span>
                    ))}
                </div>  
                {project.captureFiles &&
                            <ImageGallery 
                                items={images}
                                thumbnailPosition= "bottom"
                            />  
                        }             
            </main>
        ) : (
            'Chargement en cours...'
        )}
        </>
    );
}

export default Project;